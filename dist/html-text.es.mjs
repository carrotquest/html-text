/*!
 * @pixi/text-html - v2.1.1
 * Compiled Mon, 22 Aug 2022 09:01:05 UTC
 *
 * @pixi/text-html is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{Sprite as t}from"@pixi/sprite";import{settings as e}from"@pixi/settings";import{Texture as i}from"@pixi/core";import{Rectangle as s}from"@pixi/math";import{hex2string as o,hex2rgb as n,trimCanvas as r,sign as h}from"@pixi/utils";import{TextStyle as a}from"@pixi/text";var l=function(t){function l(o,n,r,h,a){void 0===o&&(o=""),void 0===n&&(n={}),void 0===h&&(h={}),(r=r||document.createElement("canvas")).width=3,r.height=3;var l=i.from(r,{scaleMode:e.SCALE_MODE});l.orig=new s,l.trim=new s,t.call(this,l);var c="http://www.w3.org/2000/svg",d=document.createElementNS(c,"svg"),u=document.createElementNS(c,"foreignObject"),p=document.createElementNS("http://www.w3.org/1999/xhtml","div");p.classList.add("pixi-html_text"),u.setAttribute("height","100%"),u.setAttribute("width","100%"),d.appendChild(u),this._domElement=p,this._svgRoot=d,this._foreignObject=u,this._image=new Image,this.canvas=r,this.context=this.canvas.getContext("2d"),this._resolution=a||e.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._cssStyle=null,this._loading=!1,this.text=o,this.style=n,this.cssStyle=h,this.localStyleID=-1}t&&(l.__proto__=t),l.prototype=Object.create(t&&t.prototype),l.prototype.constructor=l;var c={stringCssStyle:{configurable:!0},width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},cssStyle:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return l.prototype.updateText=function(t){var e=this,i=this.style,s=this.canvas,r=this.context,h=this.resolution;if(this.localStyleID!==i.styleID&&(this.dirty=!0,this.localStyleID=i.styleID),this.dirty||!t){var a="\n            display:inline-block;\n            color:"+i.fill+";\n            font-size: "+i.fontSize+"px;\n            font-family:"+i.fontFamily+";\n            font-weight:"+i.fontWeight+";\n            font-style:"+i.fontStyle+";\n            font-variant:"+i.fontVariant+";\n            letter-spacing:"+i.letterSpacing+"px;\n            text-align:"+i.align+";\n            padding:"+i.padding+"px;\n        ";if(i.lineHeight&&(a+="line-height:"+i.lineHeight+"px;"),i.wordWrap&&(a+="word-wrap:"+(i.breakWords?"break-all":"break-word")+";",a+="width:"+i.wordWrapWidth+"px;"),i.strokeThickness){var l=i.stroke;"number"==typeof color&&(l=o(l)),a+="-webkit-text-stroke-width: "+i.strokeThickness+"px;",a+="-webkit-text-stroke-color: "+l+";",a+="text-stroke-width: "+i.strokeThickness+"px;",a+="text-stroke-color: "+l+";",a+="paint-order: stroke;"}if(i.dropShadow){var c=i.dropShadowAngle,d=i.dropShadowDistance,u=i.dropShadowBlur,p=i.dropShadowColor,g=i.dropShadowAlpha,y=Math.round(Math.cos(c)*d),f=Math.round(Math.sin(c)*d),_=p;if("number"==typeof _&&(_=o(_)),"#"===_.charAt(0)&&g<1){var x=n(parseInt(_.replace("#",""),16));_="rgba("+(255*x[0]|0)+", "+(255*x[1]|0)+", "+(255*x[2]|0)+", "+g+")"}a+="text-shadow: "+y+"px "+f+"px "+u+"px "+_+";"}var m=this._domElement;Object.assign(m,{innerHTML:this._text,style:a});var w=document.createElement("style");w.innerHTML=this.stringCssStyle,m.insertAdjacentElement("afterbegin",w),document.body.appendChild(m);var v=m.getBoundingClientRect(),b=v.width,S=v.height;if(document.body.removeChild(m),this._foreignObject.appendChild(m),this._svgRoot.setAttribute("width",b),this._svgRoot.setAttribute("height",S),s.width=Math.ceil((Math.max(1,b)+2*i.padding)*h),s.height=Math.ceil((Math.max(1,S)+2*i.padding)*h),!this._loading){var T=this._image,k=(new XMLSerializer).serializeToString(this._svgRoot);this._loading=!0,T.src="data:image/svg+xml;charset=utf8,"+encodeURIComponent(k),T.onload=function(){r.scale(h,h),r.clearRect(0,0,s.width,s.height),r.drawImage(T,0,0,b,S,0,0,b,S),T.src="",T.onload=void 0,e._loading=!1,e.updateTexture()}}}},c.stringCssStyle.get=function(){var t="";for(var e in this._cssStyle)t+=".pixi-html_text "+e+" {"+this._cssStyle[e]+"}";return t},l.prototype.updateTexture=function(){var t=this.canvas,e=this.context,i=this.style,s=this.texture,o=this.resolution;if(i.trim){var n=r(t),h=n.width,a=n.height,l=n.data;l&&(t.width=h,t.height=a,e.putImageData(l,0,0))}var c=i.trim?0:i.padding,d=s.baseTexture;s.trim.width=s._frame.width=Math.ceil(t.width/o),s.trim.height=s._frame.height=Math.ceil(t.height/o),s.trim.x=-c,s.trim.y=-c,s.orig.width=s._frame.width-2*c,s.orig.height=s._frame.height-2*c,this._onTextureUpdate(),d.setRealSize(t.width,t.height,o),this.dirty=!1},l.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},l.prototype._renderCanvas=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._renderCanvas.call(this,e)},l.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},l.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},l.prototype._onStyleChange=function(){this.dirty=!0},l.prototype.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this.context=null,this.canvas.width=this.canvas.height=0,this.canvas=null,this._style=null,this._cssStyle=null,this._svgRoot=null,this._domElement=null,this._foreignObject=null,this._image.onload=null,this._image.src="",this._image=null},c.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this.canvas.width/this.resolution},c.width.set=function(t){this.updateText(!0);var e=h(this.scale.x)||1;this.scale.x=e*t/this.canvas.width/this.resolution,this._width=t},c.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this.canvas.height/this.resolution},c.height.set=function(t){this.updateText(!0);var e=h(this.scale.y)||1;this.scale.y=e*t/this.canvas.height/this.resolution,this._height=t},c.style.get=function(){return this._style},c.style.set=function(t){t=t||{},this._style=t instanceof a?t:new a(t),this.localStyleID=-1,this.dirty=!0},c.cssStyle.get=function(){return this._cssStyle},c.cssStyle.set=function(t){this._cssStyle=t||{},this.dirty=!0},c.text.get=function(){return this._text},c.text.set=function(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)},c.resolution.get=function(){return this._resolution},c.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},l.prototype.sanitiseText=function(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")},Object.defineProperties(l.prototype,c),l}(t);export{l as HTMLText};
//# sourceMappingURL=html-text.es.mjs.map
